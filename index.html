<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš¸ë¦‰ë„ ë…ë„ë¬¸ë°©êµ¬ ë°°ì†¡ ì˜ˆë³´</title>
    <style>
        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background: #1e293b;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            text-align: center;
        }
        h1 { color: #38bdf8; margin-bottom: 10px; font-size: 1.5rem; }
        .date { color: #94a3b8; font-size: 0.9rem; margin-bottom: 30px; }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .card {
            background: #334155;
            padding: 20px;
            border-radius: 15px;
        }
        .label { font-size: 0.9rem; color: #cbd5e1; margin-bottom: 5px; }
        .value { font-size: 1.8rem; font-weight: bold; }
        .unit { font-size: 1rem; color: #94a3b8; }

        .status-box {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        .status-good { background: #064e3b; border: 2px solid #34d399; color: #d1fae5; }
        .status-bad { background: #7f1d1d; border: 2px solid #f87171; color: #fecaca; }
        
        .message-box {
            background: #1e1e1e;
            border-left: 4px solid #38bdf8;
            padding: 15px;
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e2e8f0;
        }
        .refresh-btn {
            background: #38bdf8;
            color: #0f172a;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        .refresh-btn:hover { background: #0ea5e9; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ›³ï¸ ìš¸ë¦‰ë„ ë…ë„ë¬¸ë°©êµ¬ ë°°ì†¡ ì˜ˆë³´</h1>
        <p class="date" id="currentDate">ë‚ ì§œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>

        <div class="grid">
            <div class="card">
                <div class="label">íŒŒë„ ë†’ì´ (íŒŒê³ )</div>
                <div id="waveHeight" class="value">-</div>
                <span class="unit">m</span>
            </div>
            <div class="card">
                <div class="label">ë°”ëŒ ì„¸ê¸° (í’ì†)</div>
                <div id="windSpeed" class="value">-</div>
                <span class="unit">m/s</span>
            </div>
        </div>

        <div id="statusBox" class="status-box status-good">
            <h2 id="statusTitle" style="margin:0; font-size:1.2rem;">ë°ì´í„° ì¡°íšŒ ì¤‘...</h2>
        </div>

        <div class="message-box">
            <strong>ğŸ“¢ ì ì¥ë‹˜ì˜ í•œë§ˆë””:</strong><br>
            <span id="managerComment">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! ë°”ë‹¤ ë‚ ì”¨ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤. ğŸŒŠ</span>
        </div>

        <button class="refresh-btn" onclick="fetchWeather()">ğŸ”„ ë‚ ì”¨ ë‹¤ì‹œ í™•ì¸í•˜ê¸°</button>
    </div>

    <script>
        // â–¼â–¼â–¼ ì—¬ê¸°ì— ì¸ì¦í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (ë”°ì˜´í‘œëŠ” ì§€ìš°ì§€ ë§ˆì„¸ìš”!) â–¼â–¼â–¼
        const API_KEY = "8bcfc7f276c871e617e932d9a9bcced7bcdff2df7db491ddca0990e794a712ba"; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        function getBaseTime() {
            const now = new Date();
            const times = [2, 5, 8, 11, 14, 17, 20, 23];
            let hour = now.getHours();
            let baseDate = now.toISOString().slice(0,10).replace(/-/g,"");
            
            // ë°œí‘œ ì‹œê°„ ê³„ì‚° (API ì œê³µ ì‹œê°„ë³´ë‹¤ 1ì‹œê°„ ì „ ë°ì´í„° ì‚¬ìš© ì•ˆì „ë¹µ)
            if (hour < 2) {
                // ì „ë‚  23ì‹œ ë°ì´í„°
                const yesterday = new Date(now);
                yesterday.setDate(now.getDate() - 1);
                baseDate = yesterday.toISOString().slice(0,10).replace(/-/g,"");
                return { date: baseDate, time: "2300" };
            }

            // ê°€ì¥ ê°€ê¹Œìš´ ê³¼ê±° ì‹œê°„ ì°¾ê¸°
            let baseTime = times.filter(t => t <= hour - 1).pop();
            if (!baseTime) baseTime = 23; 
            
            return { date: baseDate, time: baseTime.toString().padStart(2, '0') + "00" };
        }

        async function fetchWeather() {
            const { date, time } = getBaseTime();
            document.getElementById('currentDate').innerText = `${date.slice(0,4)}ë…„ ${date.slice(4,6)}ì›” ${date.slice(6,8)}ì¼ ê¸°ì¤€`;

            // ìš¸ë¦‰ë„ ì¢Œí‘œ (nx=102, ny=115)
            const url = `http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${API_KEY}&pageNo=1&numOfRows=100&dataType=JSON&base_date=${date}&base_time=${time}&nx=102&ny=115`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const items = data.response.body.items.item;

                // íŒŒê³ (WAV)ì™€ í’ì†(WSD) ì°¾ê¸°
                const wave = items.find(i => i.category === 'WAV')?.fcstValue || 0;
                const wind = items.find(i => i.category === 'WSD')?.fcstValue || 0;

                updateUI(parseFloat(wave), parseFloat(wind));
            } catch (error) {
                console.error(error);
                document.getElementById('managerComment').innerText = "âš ï¸ ê¸°ìƒì²­ ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•Šì•„ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”! (í˜¹ì€ APIí‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”)";
            }
        }

        function updateUI(wave, wind) {
            const waveEl = document.getElementById('waveHeight');
            const windEl = document.getElementById('windSpeed');
            const statusBox = document.getElementById('statusBox');
            const statusTitle = document.getElementById('statusTitle');
            const comment = document.getElementById('managerComment');

            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            waveEl.innerText = wave;
            windEl.innerText = wind;

            // íŒì • ë¡œì§ (íŒŒê³  2.5m ì´ìƒ or í’ì† 12m/s ì´ìƒ -> ê²°í•­ ìœ„í—˜)
            if (wave >= 2.5 || wind >= 12) {
                statusBox.className = "status-box status-bad";
                statusTitle.innerText = "ğŸš¨ ë°° ìš´í•­ ì£¼ì˜ (ì§€ì—° ê°€ëŠ¥ì„±)";
                comment.innerHTML = `íŒŒë„ê°€ ${wave}më¡œ ë†’ê³  ë°”ëŒì´ ê±°ì„¸ìš”!<br>ë…ë„ë¬¸ë°©êµ¬ êµ¿ì¦ˆë“¤ì´ ì•ˆì „ì„ ìœ„í•´ ì ì‹œ í•­êµ¬ì—ì„œ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ë°°ì†¡ì´ í•˜ë£¨ ì •ë„ ëŠ¦ì–´ì§ˆ ìˆ˜ ìˆì–´ìš”. ğŸŒŠğŸ˜¥`;
            } else {
                statusBox.className = "status-box status-good";
                statusTitle.innerText = "ğŸŸ¢ ë°° ìš´í•­ ê°€ëŠ¥ (ì •ìƒ ë°°ì†¡)";
                comment.innerHTML = `íŒŒë„ê°€ ì”ì”í•˜ê³  ë‚ ì”¨ê°€ ì¢‹ë„¤ìš”!<br>ë…ë„ë¬¸ë°©êµ¬ êµ¿ì¦ˆë“¤ì´ ìœ¡ì§€ë¡œ ì¶œë°œí•  ì¤€ë¹„ë¥¼ ë§ˆì³¤ìŠµë‹ˆë‹¤. ê³§ ë§Œë‚˜ìš”! ğŸ›³ï¸ğŸ“¦`;
            }
        }

        // ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰
        fetchWeather();
    </script>
</body>
</html>
